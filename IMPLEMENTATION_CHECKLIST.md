# Implementation Checklist: New Architecture Migration

This checklist guides you through implementing the new React Native architecture support for react-native-audio-pro.

## Prerequisites
- [ ] React Native 0.71.0+ installed
- [ ] Xcode 14+ (for iOS development)
- [ ] Android NDK 23+ (for Android development)
- [ ] Node.js 16+ and Yarn 3.6.1+

## Phase 1: Dependency Installation ✅ COMPLETED
- [x] Updated `package.json` with `react-native-codegen`
- [x] Added `codegenConfig` to `package.json`
- [x] Created `src/specs/NativeAudioPro.ts` with TurboModule interface
- [x] Updated `AudioPro.podspec` with new architecture support
- [x] Updated `android/build.gradle` with CodeGen configuration

## Phase 2: TypeScript Configuration ✅ COMPLETED
- [x] Created TurboModule spec in `src/specs/NativeAudioPro.ts`
  - [x] Define all exposed methods
  - [x] Define parameter types (AudioTrack, PlayOptions, AmbientPlayOptions)
  - [x] Define return types (all void for async methods)
- [x] Updated `src/emitter.ts` to use new TurboModule
  - [x] Import from `src/specs/NativeAudioPro`
  - [x] Maintain backward compatibility with event emitters

## Phase 3: iOS Native Implementation ⏳ IN PROGRESS
- [ ] **Update `ios/AudioPro.swift`:**
  - [ ] Add `#if RCT_NEW_ARCH_ENABLED` conditional compilation
  - [ ] Import `AudioProSpec` for new architecture
  - [ ] Update class to support both architectures:
    - [ ] Old arch: inherit from `RCTEventEmitter`
    - [ ] New arch: inherit from `NSObject, AudioProSpec, RCTEventEmitter`
  - [ ] Add `moduleName()` and `requiresMainQueueSetup()` static methods
  - [ ] Keep all existing methods with `@objc` annotations (works for both)
  - [ ] Verify event emission works for both architectures
  - [ ] Test conditional compilation guards

## Phase 4: Android Native Implementation ⏳ IN PROGRESS
- [ ] **Update `android/src/main/java/dev/rnap/reactnativeaudiopro/AudioProModule.kt`:**
  - [ ] Add `@ReactModule` annotation
  - [ ] Keep `ReactContextBaseJavaModule` inheritance
  - [ ] Implement `EventEmitterModule` interface
  - [ ] Implement `AudioProModuleSpec` interface (generated by CodeGen)
  - [ ] Keep all `@ReactMethod` annotations
  - [ ] Implement `addListener()` and `removeListeners()` methods
  - [ ] Verify event emission uses DeviceEventManagerModule

- [ ] **Update `android/src/main/java/dev/rnap/reactnativeaudiopro/AudioProPackage.kt`:**
  - [ ] Change from `ReactPackage` to `TurboReactPackage`
  - [ ] Implement `getModule()` method
  - [ ] Implement `getReactModuleInfoProvider()` method
  - [ ] Provide module metadata for CodeGen

## Phase 5: Build Configuration ✅ COMPLETED
- [x] iOS:
  - [x] Updated `AudioPro.podspec` with React-Codegen dependency
  - [x] Added conditional Folly dependency for new arch
- [x] Android:
  - [x] Updated `android/build.gradle` with CodeGen support
  - [x] Added React Native plugin application for new arch
  - [x] Configured new arch dependencies

## Phase 6: CodeGen & Build Verification ⏳ IN PROGRESS
- [ ] **iOS:**
  - [ ] Run `RCT_NEW_ARCH_ENABLED=1 pod install` in `example/ios/`
  - [ ] Verify `ios/AudioProSpecLight.swift` is generated
  - [ ] Check for CodeGen-generated header files
  - [ ] Build with `xcodebuild` to verify compilation
  - [ ] Test in iOS simulator
  - [ ] Test on iOS device

- [ ] **Android:**
  - [ ] Set `newArchEnabled=true` in `gradle.properties` or environment
  - [ ] Run `./gradlew clean build` to trigger CodeGen
  - [ ] Verify `android/build/generated/source/codegen` exists
  - [ ] Check for `AudioProSpec.kt` generation
  - [ ] Build APK successfully
  - [ ] Test in Android emulator
  - [ ] Test on Android device

## Phase 7: Example App Testing ⏳ IN PROGRESS
- [ ] **Build with new architecture:**
  - [ ] iOS: `RCT_NEW_ARCH_ENABLED=1 yarn example ios`
  - [ ] Android: `newArchEnabled=true yarn example android`

- [ ] **Test audio playback functionality:**
  - [ ] Play audio tracks
  - [ ] Pause/Resume playback
  - [ ] Seek to position
  - [ ] Adjust playback speed
  - [ ] Adjust volume
  - [ ] Test ambient audio playback
  - [ ] Verify state change events
  - [ ] Verify progress events
  - [ ] Verify error handling

- [ ] **Test event emission:**
  - [ ] Verify STATE_CHANGED events
  - [ ] Verify PROGRESS events
  - [ ] Verify TRACK_ENDED events
  - [ ] Verify PLAYBACK_ERROR events
  - [ ] Verify SEEK_COMPLETE events
  - [ ] Verify remote control events (iOS)
  - [ ] Verify ambient audio events

## Phase 8: Backward Compatibility Testing ⏳ IN PROGRESS
- [ ] **Build with old architecture (no flags):**
  - [ ] iOS: `yarn example ios`
  - [ ] Android: `yarn example android`

- [ ] **Verify old architecture still works:**
  - [ ] All audio features functional
  - [ ] Events emit correctly
  - [ ] No errors or warnings
  - [ ] Performance is acceptable

## Phase 9: Testing & Validation ⏳ IN PROGRESS
- [ ] **Run automated tests:**
  - [ ] `yarn test` - Jest tests pass
  - [ ] `yarn lint` - No lint errors
  - [ ] `yarn typecheck` - TypeScript validates
  - [ ] `yarn check` - Full check passes

- [ ] **Manual testing:**
  - [ ] iOS simulator testing
  - [ ] iOS device testing
  - [ ] Android emulator testing
  - [ ] Android device testing
  - [ ] Test on multiple RN versions

## Phase 10: Documentation ⏳ NOT STARTED
- [ ] **Update documentation:**
  - [ ] Add new architecture section to README.md
  - [ ] Document build process for both architectures
  - [ ] Add troubleshooting guide
  - [ ] Document migration process for users
  - [ ] Add version compatibility matrix
  - [ ] Update CONTRIBUTING.md with new arch info

- [ ] **Create guides:**
  - [x] Created `MIGRATION.md` - Overview guide
  - [x] Created `MIGRATION_STATUS.md` - Status tracking
  - [x] Created `docs/SETUP_NEW_ARCHITECTURE.md` - Setup guide
  - [x] Created `docs/MIGRATION_iOS.md` - iOS guide
  - [x] Created `docs/MIGRATION_Android.md` - Android guide
  - [x] Created `docs/IMPLEMENTATION_EXAMPLE_iOS.swift` - iOS example
  - [x] Created `docs/IMPLEMENTATION_EXAMPLE_Android.kt` - Android example
  - [ ] Create video tutorial (optional)

## Phase 11: Release Preparation ⏳ NOT STARTED
- [ ] **Prepare release:**
  - [ ] Bump version number
  - [ ] Update CHANGELOG.md
  - [ ] Tag commit with version
  - [ ] Run `yarn release` to publish
  - [ ] Create GitHub release with notes

- [ ] **Post-release:**
  - [ ] Monitor for issues
  - [ ] Update website/blog
  - [ ] Announce in community channels
  - [ ] Support early adopters

## Troubleshooting Tips

### iOS Build Issues
```bash
# Clean Pods and reinstall with new arch
rm -rf ios/Pods ios/Podfile.lock
RCT_NEW_ARCH_ENABLED=1 pod install

# Clean build folder
xcodebuild clean -workspace ios/AudioProExample.xcworkspace -scheme AudioProExample
```

### Android Build Issues
```bash
# Clean and rebuild
./gradlew clean build -x lint

# With new arch enabled
newArchEnabled=true ./gradlew clean build
```

### CodeGen Issues
```bash
# Verify spec file syntax
npx react-native-codegen --help

# Run CodeGen manually
npx react-native-codegen AudioPro src/specs/NativeAudioPro.ts
```

## Success Criteria
- [x] Documentation is comprehensive
- [x] TypeScript spec is properly defined
- [x] Configuration files are updated
- [ ] iOS builds with new architecture
- [ ] Android builds with new architecture
- [ ] Example app runs on both platforms
- [ ] Audio playback works correctly
- [ ] Events emit properly
- [ ] All tests pass
- [ ] Backward compatibility maintained
- [ ] README updated
- [ ] Ready for release

## Related Documentation
- [MIGRATION.md](./MIGRATION.md) - Overview
- [MIGRATION_STATUS.md](./MIGRATION_STATUS.md) - Current status
- [docs/SETUP_NEW_ARCHITECTURE.md](./docs/SETUP_NEW_ARCHITECTURE.md) - Setup guide
- [docs/MIGRATION_iOS.md](./docs/MIGRATION_iOS.md) - iOS implementation
- [docs/MIGRATION_Android.md](./docs/MIGRATION_Android.md) - Android implementation
- [docs/IMPLEMENTATION_EXAMPLE_iOS.swift](./docs/IMPLEMENTATION_EXAMPLE_iOS.swift) - Code example
- [docs/IMPLEMENTATION_EXAMPLE_Android.kt](./docs/IMPLEMENTATION_EXAMPLE_Android.kt) - Code example

## Timeline Estimate
- **Completed**: 4-5 hours (configuration, specs, TypeScript)
- **In Progress**: 3-4 hours (native implementations)
- **Remaining**: 2-3 hours (testing, docs, release)
- **Total**: ~9-12 hours

---

**Last Updated**: January 15, 2025
**Current Phase**: Phase 3 - iOS Native Implementation
**Overall Progress**: ~40% complete
